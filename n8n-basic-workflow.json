{
  "name": "Lotus Proposta Generator",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "bc635618-3f64-4db0-950e-feefaa899344",
        "responseMode": "responseNode"
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [240, 300],
      "id": "webhook-node"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ \n{\n  numeroProsposta: \"LP\" + $now.format('YYYYMMDDHHMM'),\n  nome: $json.nome,\n  cpfCnpj: $json.cpfCnpj,\n  rgInsEst: $json.rgInsEst,\n  orgaoExpedidor: $json.orgaoExpedidor,\n  sexo: $json.sexo,\n  naturalidade: $json.naturalidade,\n  nacionalidade: $json.nacionalidade,\n  telefoneCelular: $json.telefoneCelular,\n  profissao: $json.profissao,\n  email: $json.email,\n  enderecoCompleto: ($json.logradouro + \" \" + $json.numero + \" \" + ($json.complemento || \"\")).trim(),\n  bairro: $json.bairro,\n  cidade: $json.cidade,\n  uf: $json.uf,\n  cep: $json.cep,\n  estadoCivil: $json.estadoCivil,\n  isMarried: $json.estadoCivil === \"casado\" || $json.estadoCivil === \"uniao-estavel\",\n  nomeConjuge: $json.nomeConjuge,\n  cpfConjuge: $json.cpfConjuge,\n  rgConjuge: $json.rgConjuge,\n  empreendimento: $json.empreendimento === \"haya\" ? \"HAYA\" : $json.empreendimento === \"kasa\" ? \"KASA\" : $json.empreendimento === \"vert\" ? \"VERT\" : $json.empreendimento === \"alma\" ? \"ALMA\" : $json.empreendimento,\n  unidadeNumero: $json.unidadeNumero,\n  valorImovel: $json.valorImovel,\n  valorEntrada: $json.valorEntrada,\n  valorFinanciar: $json.valorFinanciar,\n  documentos: $json.documentos || [],\n  quantidadeDocumentos: ($json.documentos || []).length,\n  dataAtual: $now.format('DD/MM/YYYY'),\n  originalData: $json\n}\n}}"
      },
      "name": "Preparar Dados",
      "type": "n8n-nodes-base.code",
      "position": [460, 300],
      "id": "prepare-data"
    },
    {
      "parameters": {
        "url": "https://htmlcsstoimage.com/demo_run",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer YOUR_HTMLCSSTOIMAGE_API_KEY"
            }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "bodyParameters": {
          "parameters": [
            {
              "name": "html",
              "value": "={{ $json.htmlContent }}"
            },
            {
              "name": "css",
              "value": ""
            },
            {
              "name": "google_fonts",
              "value": "Inter"
            },
            {
              "name": "device_scale",
              "value": "2"
            },
            {
              "name": "format",
              "value": "pdf"
            }
          ]
        }
      },
      "name": "HTML para PDF",
      "type": "n8n-nodes-base.httpRequest",
      "position": [900, 300],
      "id": "html-to-pdf"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ \n{\n  htmlContent: `<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Proposta de Compra - Lotus</title>\n    <style>\n        body { font-family: Arial, sans-serif; font-size: 12px; color: #1A1A1A; padding: 20px; margin: 0; }\n        .container { max-width: 800px; margin: 0 auto; }\n        .header { background: #FFC629; padding: 25px; text-align: center; border-radius: 8px; margin-bottom: 25px; }\n        .header h1 { font-size: 18px; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; }\n        .number { background: #1A1A1A; color: #FFC629; padding: 6px 12px; border-radius: 15px; font-weight: bold; display: inline-block; }\n        .section { margin-bottom: 25px; background: #FEFCF7; border-radius: 6px; padding: 18px; }\n        .section-title { background: #FFC629; font-weight: bold; font-size: 13px; padding: 10px 18px; border-radius: 20px; margin-bottom: 18px; text-align: center; text-transform: uppercase; }\n        .form-row { display: flex; margin-bottom: 12px; align-items: center; flex-wrap: wrap; gap: 12px; }\n        .form-group { display: flex; align-items: center; margin-bottom: 6px; min-width: 180px; }\n        .form-group.full { flex: 1; min-width: 280px; }\n        .form-label { font-weight: bold; margin-right: 8px; color: #5A5A5A; text-transform: uppercase; font-size: 9px; min-width: 70px; }\n        .form-value { border-bottom: 2px solid #FFC629; padding: 3px 6px; min-width: 100px; font-weight: 500; }\n        .values-section { background: #F0FDF4; border: 2px solid #10B981; border-radius: 6px; padding: 15px; margin: 15px 0; }\n        .value-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #E5E7EB; }\n        .value-item:last-child { border-bottom: none; font-weight: bold; }\n        .value-label { font-weight: bold; color: #374151; }\n        .value-amount { font-weight: bold; color: #10B981; font-size: 13px; }\n        .conditions { margin-top: 25px; background: #F8F8F8; border-radius: 6px; padding: 18px; }\n        .condition-item { margin-bottom: 12px; text-align: justify; line-height: 1.4; padding: 8px; background: #fff; border-radius: 4px; border-left: 3px solid #FFC629; }\n        .signatures { margin-top: 40px; display: flex; justify-content: space-between; gap: 30px; }\n        .signature-box { text-align: center; flex: 1; }\n        .signature-line { border-top: 2px solid #1A1A1A; height: 60px; margin-bottom: 8px; margin-top: 30px; }\n        .date-location { text-align: center; margin: 25px 0; font-weight: bold; font-size: 12px; }\n        .document-page { page-break-before: always; margin-top: 30px; }\n        .document-header { background: #FFC629; padding: 15px; border-radius: 6px; margin-bottom: 15px; text-align: center; }\n        .document-image { text-align: center; margin: 15px 0; }\n        .document-image img { max-width: 100%; max-height: 650px; border: 1px solid #E5E7EB; border-radius: 4px; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <div style=\"background: #1A1A1A; display: inline-block; padding: 12px 18px; border-radius: 10px; margin-bottom: 15px; color: #FFC629; font-weight: bold;\">LOTUS</div>\n            <h1>Proposta de Compra com Recibo de Sinal</h1>\n            <div class=\"number\">Nº ${$json.numeroProsposta}</div>\n        </div>\n        \n        <div class=\"section\">\n            <div class=\"form-row\">\n                <div class=\"form-group full\">\n                    <span class=\"form-label\">NOME/1º PROPONENTE:</span>\n                    <span class=\"form-value\">${$json.nome || ''}</span>\n                </div>\n            </div>\n            \n            <div class=\"form-row\">\n                <div class=\"form-group\">\n                    <span class=\"form-label\">CPF/CNPJ:</span>\n                    <span class=\"form-value\">${$json.cpfCnpj || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">RG:</span>\n                    <span class=\"form-value\">${$json.rgInsEst || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">ÓRGÃO EXP.:</span>\n                    <span class=\"form-value\">${$json.orgaoExpedidor || ''}</span>\n                </div>\n            </div>\n            \n            <div class=\"form-row\">\n                <div class=\"form-group\">\n                    <span class=\"form-label\">SEXO:</span>\n                    <span class=\"form-value\">${$json.sexo || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">NATURALIDADE:</span>\n                    <span class=\"form-value\">${$json.naturalidade || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">NACIONALIDADE:</span>\n                    <span class=\"form-value\">${$json.nacionalidade || ''}</span>\n                </div>\n            </div>\n            \n            <div class=\"form-row\">\n                <div class=\"form-group\">\n                    <span class=\"form-label\">TELEFONE:</span>\n                    <span class=\"form-value\">${$json.telefoneCelular || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">PROFISSÃO:</span>\n                    <span class=\"form-value\">${$json.profissao || ''}</span>\n                </div>\n            </div>\n\n            <div class=\"form-row\">\n                <div class=\"form-group full\">\n                    <span class=\"form-label\">E-MAIL:</span>\n                    <span class=\"form-value\">${$json.email || ''}</span>\n                </div>\n            </div>\n\n            <div class=\"form-row\">\n                <div class=\"form-group full\">\n                    <span class=\"form-label\">ENDEREÇO:</span>\n                    <span class=\"form-value\">${$json.enderecoCompleto}</span>\n                </div>\n            </div>\n\n            <div class=\"form-row\">\n                <div class=\"form-group\">\n                    <span class=\"form-label\">BAIRRO:</span>\n                    <span class=\"form-value\">${$json.bairro || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">CIDADE:</span>\n                    <span class=\"form-value\">${$json.cidade || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">CEP:</span>\n                    <span class=\"form-value\">${$json.cep || ''}</span>\n                </div>\n            </div>\n\n            ${$json.isMarried ? `\n            <div style=\"margin-top: 20px; padding-top: 15px; border-top: 1px solid #F5F5F5;\">\n                <div class=\"form-row\">\n                    <div class=\"form-group full\">\n                        <span class=\"form-label\">CÔNJUGE/2º PROPONENTE:</span>\n                        <span class=\"form-value\">${$json.nomeConjuge || ''}</span>\n                    </div>\n                </div>\n                <div class=\"form-row\">\n                    <div class=\"form-group\">\n                        <span class=\"form-label\">CPF CÔNJUGE:</span>\n                        <span class=\"form-value\">${$json.cpfConjuge || ''}</span>\n                    </div>\n                    <div class=\"form-group\">\n                        <span class=\"form-label\">RG CÔNJUGE:</span>\n                        <span class=\"form-value\">${$json.rgConjuge || ''}</span>\n                    </div>\n                </div>\n            </div>\n            ` : ''}\n        </div>\n\n        <div class=\"section-title\">DADOS DO IMÓVEL OBJETO DESTA PROPOSTA</div>\n        <div class=\"section\">\n            <div class=\"form-row\">\n                <div class=\"form-group\">\n                    <span class=\"form-label\">EMPREENDIMENTO:</span>\n                    <span class=\"form-value\">${$json.empreendimento}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">INCORPORADORA:</span>\n                    <span class=\"form-value\">LOTUS CIDADE</span>\n                </div>\n            </div>\n\n            <div class=\"form-row\">\n                <div class=\"form-group\">\n                    <span class=\"form-label\">UNIDADE Nº:</span>\n                    <span class=\"form-value\">${$json.unidadeNumero || ''}</span>\n                </div>\n                <div class=\"form-group\">\n                    <span class=\"form-label\">CIDADE:</span>\n                    <span class=\"form-value\">Brasília-DF</span>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"section-title\">VALORES DA PROPOSTA</div>\n        <div class=\"values-section\">\n            <div class=\"value-item\">\n                <span class=\"value-label\">(A) VALOR DA PROPOSTA:</span>\n                <span class=\"value-amount\">R$ ${$json.valorImovel || '0,00'}</span>\n            </div>\n            <div class=\"value-item\">\n                <span class=\"value-label\">(B) VALOR DE ENTRADA:</span>\n                <span class=\"value-amount\">R$ ${$json.valorEntrada || '0,00'}</span>\n            </div>\n            <div class=\"value-item\">\n                <span class=\"value-label\">(C) VALOR A FINANCIAR:</span>\n                <span class=\"value-amount\">R$ ${$json.valorFinanciar || '0,00'}</span>\n            </div>\n        </div>\n\n        ${($json.documentos && $json.documentos.length > 0) ? `\n        <div class=\"section-title\">DOCUMENTOS ANEXADOS</div>\n        <div class=\"section\">\n            <div style=\"background: #F0FDF4; border: 2px solid #10B981; border-radius: 6px; padding: 12px; margin-bottom: 15px;\">\n                <strong style=\"color: #10B981;\">Total de ${$json.quantidadeDocumentos} documento(s) anexado(s)</strong>\n            </div>\n        </div>\n        \n        ${$json.documentos.map(doc => {\n          const categoryLabels = {\n            'rg': 'RG',\n            'cpf': 'CPF',\n            'residencia': 'Comp. Residência',\n            'renda': 'Comp. Renda',\n            'casamento': 'Cert. Casamento',\n            'rg-conjuge': 'RG Cônjuge',\n            'cpf-conjuge': 'CPF Cônjuge',\n            'renda-conjuge': 'Renda Cônjuge',\n            'outros': 'Outros'\n          };\n          \n          return `\n            <div style=\"page-break-before: always; margin-top: 30px;\">\n                <div style=\"background: #FFC629; padding: 15px; border-radius: 6px; margin-bottom: 15px; text-align: center;\">\n                    <strong>${categoryLabels[doc.category] || 'Documento'} - ${doc.name}</strong>\n                    <div style=\"font-size: 10px; margin-top: 5px;\">\n                        ${Math.round(doc.size / 1024)} KB • ${doc.type}\n                    </div>\n                </div>\n                \n                ${doc.base64 && doc.type.includes('image') ? `\n                    <div style=\"text-align: center; margin: 15px 0;\">\n                        <img src=\"${doc.base64}\" alt=\"${doc.name}\" style=\"max-width: 100%; max-height: 650px; border: 1px solid #E5E7EB; border-radius: 4px;\">\n                    </div>\n                ` : ''}\n            </div>\n          `;\n        }).join('')}\n        ` : ''}\n\n        <div style=\"margin-top: 25px; background: #F8F8F8; border-radius: 6px; padding: 18px;\">\n            <h3 style=\"font-weight: bold; margin-bottom: 12px; color: #1A1A1A; text-transform: uppercase; font-size: 12px;\">Condições Gerais:</h3>\n            <div style=\"margin-bottom: 12px; text-align: justify; line-height: 1.4; padding: 8px; background: #fff; border-radius: 4px; border-left: 3px solid #FFC629;\">\n                <strong>1 -</strong> A presente proposta ficará sujeita a confirmação pela Incorporadora, facultado-lhe recusar expressamente esta proposta no prazo de até 48 (quarenta e oito) horas, contadas desta data.\n            </div>\n            <div style=\"margin-bottom: 12px; text-align: justify; line-height: 1.4; padding: 8px; background: #fff; border-radius: 4px; border-left: 3px solid #FFC629;\">\n                <strong>2 -</strong> Pelo presente instrumento o proponente retro qualificado promete comprar o(s) imóvel(is) objeto(s) deste pelo preço e prazos ali estabelecidos.\n            </div>\n            <div style=\"margin-bottom: 12px; text-align: justify; line-height: 1.4; padding: 8px; background: #fff; border-radius: 4px; border-left: 3px solid #FFC629;\">\n                <strong>3 -</strong> No caso de financiamento junto a um agente financeiro, o proponente comprador obriga-se a fornecer todos os documentos necessários exigidos.\n            </div>\n        </div>\n\n        <div style=\"text-align: center; margin: 25px 0; font-weight: bold; font-size: 12px;\">\n            Brasília-DF, ${$json.dataAtual}\n        </div>\n\n        <div style=\"margin-top: 40px; display: flex; justify-content: space-between; gap: 30px;\">\n            <div style=\"text-align: center; flex: 1;\">\n                <div style=\"border-top: 2px solid #1A1A1A; height: 60px; margin-bottom: 8px; margin-top: 30px;\"></div>\n                <div style=\"font-weight: bold; color: #5A5A5A; text-transform: uppercase; font-size: 9px;\">Proponente(s) Comprador(es)</div>\n            </div>\n            <div style=\"text-align: center; flex: 1;\">\n                <div style=\"border-top: 2px solid #1A1A1A; height: 60px; margin-bottom: 8px; margin-top: 30px;\"></div>\n                <div style=\"font-weight: bold; color: #5A5A5A; text-transform: uppercase; font-size: 9px;\">CORRETOR</div>\n            </div>\n        </div>\n    </div>\n</body>\n</html>`\n}\n}}"
      },
      "name": "Gerar HTML",
      "type": "n8n-nodes-base.code",
      "position": [680, 300],
      "id": "generate-html"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ \n{\n  \"success\": true,\n  \"message\": \"Proposta processada com sucesso\",\n  \"pdfUrl\": $json.url,\n  \"numeroProsposta\": $('Preparar Dados').first().json.numeroProsposta,\n  \"nomeCliente\": $('Preparar Dados').first().json.nome,\n  \"timestamp\": $now.toISOString()\n}\n}}"
      },
      "name": "Resposta",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1120, 300],
      "id": "response-node"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Preparar Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Dados": {
      "main": [
        [
          {
            "node": "Gerar HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gerar HTML": {
      "main": [
        [
          {
            "node": "HTML para PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML para PDF": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "versionId": "1"
}